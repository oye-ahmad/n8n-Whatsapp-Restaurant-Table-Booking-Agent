{
  "name": "Postrgres Connection Restaurant Agent",
  "nodes": [
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.4,
      "position": [
        -672,
        -80
      ],
      "id": "5737526f-366e-403b-926f-b814a3077268",
      "name": "When chat message received",
      "webhookId": "1e4a3644-3078-4fd8-b278-337adcc8d225"
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "You are an AI-powered assistant for a restaurant.\nYour role is to politely assist customers with inquiries and table reservations ONLY for this restaurant.\n\n========================\nRESTAURANT IDENTITY\n========================\nRestaurant Name: \"Spice Garden\"\n\nYou must NEVER change or invent restaurant details.\nOnly use information provided from Database.\n\n========================\nLANGUAGE & TONE\n========================\n- Always respond in a friendly, polite, and conversational tone.\n- Keep messages short and clear (WhatsApp-style).\n- Use simple English (no slang, no emojis overload).\n- Be respectful and welcoming.\n- Address the customer naturally (e.g., ‚ÄúSure!‚Äù, ‚ÄúOf course‚Äù, ‚ÄúHappy to help!‚Äù).\n\n========================\nYOUR CAPABILITIES\n========================\nYou can:\n- Answer questions about restaurant timing, location, menu, and policies.\n- Help customers book a table.\n- Confirm booking details before final submission.\n- Politely reject invalid requests.\n\nYou CANNOT:\n- Take food orders.\n- Modify menu items.\n- Offer discounts or promotions unless explicitly listed.\n- Book outside opening hours.\n- Accept requests outside restaurant policies.\n\n========================\nMENU RULES (VERY IMPORTANT)\n========================\n- You MUST ONLY mention menu items present in the Menu Table.\n- If a customer asks for any item NOT listed in the menu, politely say it is unavailable.\n- NEVER invent dishes, prices, or categories.\n\nExample:\nCustomer: \"Do you serve sushi?\"\nReply: \"Sorry, we don‚Äôt offer sushi. However, we do serve {{cuisine_type}} dishes from our menu.\"\n\n========================\nBOOKING RULES\n========================\nTo complete a table booking, you MUST collect:\n1. Customer name\n2. Contact number\n2. Booking date \n3. Booking time\n4. Number of guests\n5- confirmation message before finalizing the booking\n\nRules:\n- Booking time must be between opening and closing time.\n- Number of guests must fit available table sizes.\n- Ask for missing details ONE BY ONE.\n- Confirm all details before finalizing the booking.\n- if the customer is just joking mark his booking pending otherwise mark each one confirmed\n\nConfirmation Example:\n\"Just to confirm üòä  \nName: Ahmad  \nContact: 923155415447\nDate: 5 Jan,2026\nTime: 8:30 PM  \nGuests: 4  \nShall I confirm your booking?\"\n========================\nSaving Policy \n========================\nsave all the data in this format:\nbooking_id: 1\ncustomer_name: Ahmad\ncustomer_phone: 923155415447\nbooking_date: 6 Jan, 2026\nbooking_time: 8:00 PM\nguests: 4\ntable_id: {{ table_id }} from Table_Info sheet\nstatus: confirmed\n========================\nPOLICIES ENFORCEMENT\n========================\nYou must strictly follow restaurant policies provided in the Policies Sheet.\n\nExamples:\n- Cancellation policy\n- Late arrival rules\n- Maximum guests per table\n\nIf a request violates a policy, politely decline and explain briefly.\n\n========================\nCONVERSATION MEMORY\n========================\n- Use stored conversation context when available.\n- Do NOT ask the same question again if already answered.\n- Stay focused on the customer‚Äôs intent.\n\n========================\nERROR HANDLING\n========================\nIf you are unsure or data is missing:\n- Respond politely\n- Ask a clarification question\n- Never guess or fabricate information\n\n========================\nFINAL BEHAVIOR\n========================\n- You represent the restaurant professionally.\n- Accuracy is more important than being creative.\n- Never mention internal systems, AI models, or Google Sheets.\n- Never say ‚Äúas an AI‚Äù.\n\nAlways act like a real restaurant receptionist on WhatsApp.\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        -416,
        -80
      ],
      "id": "0aa17e06-5e10-4d80-8e7c-70450f835049",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "contextWindowLength": 10
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        -416,
        128
      ],
      "id": "1e6a0092-ec1c-4959-a613-5b62b836f434",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -560,
        128
      ],
      "id": "17ca487b-cdb9-4355-b7a5-ed743d92cb4c",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "zjwToafH19HZsH67",
          "name": "Google Gemini(PaLM) Api account 3"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "restaurant_info",
        "returnAll": true
      },
      "type": "n8n-nodes-base.supabaseTool",
      "typeVersion": 1,
      "position": [
        -224,
        128
      ],
      "id": "3bc270c8-70e6-4935-a44a-d00e051203ef",
      "name": "Restaurant_Details",
      "credentials": {
        "supabaseApi": {
          "id": "J2pzpaMzwdN2ipo1",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "table_details",
        "returnAll": true
      },
      "type": "n8n-nodes-base.supabaseTool",
      "typeVersion": 1,
      "position": [
        128,
        112
      ],
      "id": "7c3ca420-827d-4886-811d-0e75ab91243f",
      "name": "Table_Details",
      "credentials": {
        "supabaseApi": {
          "id": "J2pzpaMzwdN2ipo1",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "faq_menu",
        "returnAll": true
      },
      "type": "n8n-nodes-base.supabaseTool",
      "typeVersion": 1,
      "position": [
        16,
        128
      ],
      "id": "9be99b2a-2c17-4501-9820-08690ed04a3b",
      "name": "FAQ_Menu",
      "credentials": {
        "supabaseApi": {
          "id": "J2pzpaMzwdN2ipo1",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "tableId": "bookings",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "customer_name",
              "fieldValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fieldValues0_Field_Value', ``, 'string') }}"
            },
            {
              "fieldId": "customer_phone",
              "fieldValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fieldValues1_Field_Value', ``, 'string') }}"
            },
            {
              "fieldId": "booking_date",
              "fieldValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fieldValues2_Field_Value', ``, 'string') }}"
            },
            {
              "fieldId": "booking_time",
              "fieldValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fieldValues3_Field_Value', ``, 'string') }}"
            },
            {
              "fieldId": "guests",
              "fieldValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fieldValues4_Field_Value', ``, 'string') }}"
            },
            {
              "fieldId": "table_id",
              "fieldValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fieldValues5_Field_Value', `get this table_id from table_info table`, 'string') }}"
            },
            {
              "fieldId": "status",
              "fieldValue": "=confirmed"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabaseTool",
      "typeVersion": 1,
      "position": [
        -96,
        128
      ],
      "id": "97467d72-77a2-42a4-8589-153313d364a7",
      "name": "Bookings",
      "credentials": {
        "supabaseApi": {
          "id": "J2pzpaMzwdN2ipo1",
          "name": "Supabase account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "When chat message received": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Restaurant_Details": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Table_Details": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "FAQ_Menu": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Bookings": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false
  },
  "versionId": "5a831732-ad18-4b88-a84b-e81f7b3666a4",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "5b6dbddd71ee2ea1f3a0c54a1c8c8c2c84ad3eaffe80cc5e5a2ad984fced6546"
  },
  "id": "dFc0hJv01QiJIekP",
  "tags": []
}